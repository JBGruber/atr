---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.path = "man/figures/README-",
  out.width = "100%"
)
knitr::knit_hooks$set(document = function(x, options) 
  gsub("(figures/", "(vignettes/figures/", x, fixed = TRUE))

library(dplyr)
library(purrr)
```

# atr <img src="man/figures/logo.png" align="right" height="120">

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![R-CMD-check](https://github.com/JBGruber/atr/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/JBGruber/atr/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/JBGruber/atr/branch/main/graph/badge.svg)](https://app.codecov.io/gh/JBGruber/atr?branch=main)
<!-- badges: end -->

The goal of atr is to wrap the AT Protocol (Authenticated Transfer Protocol) behind Bluesky. *And we have actually already fulfilled this goal!*

The entire protocol is open and documented in so-called [lexicons](https://atproto.com/guides/lexicon), from which we autogenerated `R` functions.

These are not exported, however, since dealing with them is a bit advanced.
Rather we have some nice human-generated functions with documentation and examples.

## Installation

You can install the development version of `atr` like so (`pak` works similar to `remotes` here, but it's what the cool kids use now :grin:):

``` r
# install.packages("pak")
pak::pak("JBGruber/atr")
```

## Load the package

```{r setup}
library(atr)
```


## Authentication

The first time you make a request, you will be prompted automatically to enter your user handle and an app password to authenticate `atr` to communicate with BlueSky for you.

![RStudio Popup](figures/password_popup.png)

The page to generate app passwords is also automatically opened for you.

![page to create new app passwords](figures/app_password.png)

However, you can also trigger this process manually:

```{r eval=FALSE}
auth("jbgruber.bsky.social")
```

This can be useful if you want to replace an old token as it is permanently stored encrypted on disk.



## Retrieve Skeets (`get_skeets_authored_by`)

To fetch all the skeets by a specific user, use the `get_skeets_authored_by` function. *Note this also includes quote skeets and reskeets.* You can also opt not to parse the result by setting `parse = FALSE`, however it is recommended to use the default parse option which results in a (more) tidy tibble.

```{r}
get_skeets_authored_by(actor = "benguinaudeau.bsky.social", parse = TRUE) |>
  dplyr::glimpse()
```




## Analyzing Feeds on Blue Sky

On Blue Sky users have the ability to create custom feeds based on specific keywords. These feeds aggregate content, for instance, a user might curate a feed around the hashtag `#rstats` to gather all relevant content about. Let's delve into the dynamics of such feeds.


Our starting point is to extract the posts from the `#rstats` feed created by "andrew.heiss.phd".


```{r}
# Fetching the feed posts
feeds <- get_feeds_created_by(actor = "andrew.heiss.phd") 

# Filtering for a specific keyword, for example "#rstats"
rstat_feed <- feeds |>
  filter(displayName == "#rstats")

# Extracting posts from this curated feed
rstat_posts <- get_feed(rstat_feed$uri, limit = 200) |>
  # Extracting user handle from the author
  mutate(handle = author |> map_chr(~{.x$handle}))  |>
  dplyr::glimpse()
```

## Learn More?

Start with the [Basic Usage](https://jbgruber.github.io/atr/articles/Basic_Usage.html) vignette to learn more.

# Want to help?

You can help by creating an [issue](https://github.com/JBGruber/atr/issues/new/choose) requesting new features or reporting bugs.

If you are a developer, we are happy to accept pull requests.

It should be fairly straightforward, as all endpoints are already covered by automatically generated function.

But please open an issue first, so we don't do duplicated work.
