
<!-- README.md is generated from README.Rmd. Please edit that file -->

# atr <img src="man/figures/logo.png" align="right" height="120">

<!-- badges: start -->

[![Lifecycle:
experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![R-CMD-check](https://github.com/JBGruber/atr/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/JBGruber/atr/actions/workflows/R-CMD-check.yaml)
[![Codecov test
coverage](https://codecov.io/gh/JBGruber/atr/branch/main/graph/badge.svg)](https://app.codecov.io/gh/JBGruber/atr?branch=main)
<!-- badges: end -->

The goal of atr is to wrap the AT Protocol (Authenticated Transfer
Protocol) behind Bluesky. *And we have actually already fulfilled this
goal!*

The entire protocol is open and documented in so-called
[lexicons](https://atproto.com/guides/lexicon), from which we
autogenerated `R` functions.

These are not exported, however, since dealing with them is a bit
advanced. Rather we have some nice human-generated functions with
documentation and examples.

## Installation

You can install the development version of `atr` like so (install the
`remotes` package first, with `install.packages("remotes")`, if you
don’t have that yet):

``` r
# install.packages("remotes")
remotes::install_github("JBGruber/atr")
```

## Load the package

``` r
library(atr)
```

## Authentication

The first time you make a request, you will be prompted automatically to
enter your user handle and an app password to authenticate `atr` to
communicate with BlueSky for you.

<figure>
<img src="vignettes/figures/password_popup.png" alt="RStudio Popup" />
<figcaption aria-hidden="true">RStudio Popup</figcaption>
</figure>

The page to generate app passwords is also automatically opened for you.

<figure>
<img src="vignettes/figures/app_password.png"
alt="page to create new app passwords" />
<figcaption aria-hidden="true">page to create new app
passwords</figcaption>
</figure>

However, you can also trigger this process manually:

``` r
auth("jbgruber.bsky.social")
```

This can be useful if you want to replace an old token as it is
permanently stored encrypted on disk.

## Retrieve Skeets (`get_skeets_authored_by`)

To fetch all the skeets by a specific user, use the
`get_skeets_authored_by` function. *Note this also includes quote skeets
and reskeets.* You can also opt not to parse the result by setting
`parse = FALSE`, however it is recommended to use the default parse
option which results in a (more) tidy tibble.

``` r
get_skeets_authored_by(actor = "benguinaudeau.bsky.social", parse = TRUE) |>
  dplyr::glimpse()
#> Rows: 25
#> Columns: 16
#> $ uri           <chr> "at://did:plc:hwbpa3fiiv6mmqkrmaxckntk/app.bsky.feed.pos…
#> $ cid           <chr> "bafyreidvg65cygp7h3dtyn64tiyic5ediahrixfdan7gyg2ve3xgoi…
#> $ author_handle <chr> "fortunato.bsky.social", "mathieugallard.bsky.social", "…
#> $ author_name   <chr> "David Fortunato", "mathieu gallard", "Benjamin Guinaude…
#> $ text          <chr> "Inspired by the monotony of my review queue, here are 1…
#> $ author_data   <list> ["did:plc:hwbpa3fiiv6mmqkrmaxckntk", "fortunato.bsky.so…
#> $ post_data     <list> ["Inspired by the monotony of my review queue, here are…
#> $ embed_data    <list> <NULL>, ["app.bsky.embed.images#view", [["https://cdn.b…
#> $ reply_count   <int> 5, 0, 1, 7, 0, 1, 0, 1, 0, 0, 0, 0, 1, 12, 0, 0, 1, 1, 1…
#> $ repost_count  <int> 15, 2, 1, 366, 3, 1, 4, 28, 0, 0, 0, 0, 0, 290, 14, 1, 1…
#> $ like_count    <int> 43, 6, 1, 498, 8, 3, 10, 34, 0, 0, 1, 4, 2, 455, 37, 8, …
#> $ indexed_at    <dttm> 2023-12-23 22:08:11, 2023-12-24 14:57:01, 2023-12-21 03…
#> $ in_reply_to   <chr> NA, "at://did:plc:cy3nxnkuk6qvibtybejs65nm/app.bsky.feed…
#> $ in_reply_root <chr> NA, "at://did:plc:cy3nxnkuk6qvibtybejs65nm/app.bsky.feed…
#> $ quotes        <chr> NA, NA, "at://did:plc:3mcek454ldmpf2xr43auvhac/app.bsky.…
#> $ is_reskeet    <lgl> TRUE, TRUE, FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, FALSE,…
```

## Analyzing Feeds on Blue Sky

On Blue Sky users have the ability to create custom feeds based on
specific keywords. These feeds aggregate content, for instance, a user
might curate a feed around the hashtag `#rstats` to gather all relevant
content about. Let’s delve into the dynamics of such feeds.

Our starting point is to extract the posts from the `#rstats` feed
created by “andrew.heiss.phd”.

``` r
# Fetching the feed posts
feeds <- get_feeds_created_by(actor = "andrew.heiss.phd") 

# Filtering for a specific keyword, for example "#rstats"
rstat_feed <- feeds |>
  filter(displayName == "#rstats")

# Extracting posts from this curated feed
rstat_posts <- get_feed(rstat_feed$uri, limit = 200) |>
  dplyr::glimpse()
#> Rows: 79
#> Columns: 15
#> $ uri           <chr> "at://did:plc:kizxn77jkp4p5vqzapbedvg2/app.bsky.feed.pos…
#> $ cid           <chr> "bafyreiaabdszn3z7ka5c5zm2e2ufkjrlqpqubchphbexhoknrozkab…
#> $ author_handle <chr> "pmaier1971.bsky.social", "pmaier1971.bsky.social", "nre…
#> $ author_name   <chr> "Philipp Maier", "Philipp Maier", "Nicola Rennie", "Rcha…
#> $ text          <chr> "US #HouseholdDebt in Jul 2023 at 75.24%. This index mea…
#> $ author_data   <list> ["did:plc:kizxn77jkp4p5vqzapbedvg2", "pmaier1971.bsky.s…
#> $ post_data     <list> ["US #HouseholdDebt in Jul 2023 at 75.24%. This index m…
#> $ embed_data    <list> ["app.bsky.embed.images#view", [["https://cdn.bsky.app/…
#> $ reply_count   <int> 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0,…
#> $ repost_count  <int> 0, 0, 0, 2, 0, 0, 3, 3, 0, 0, 0, 0, 4, 0, 0, 0, 0, 4, 0,…
#> $ like_count    <int> 0, 0, 7, 2, 5, 11, 2, 9, 0, 0, 0, 0, 11, 0, 1, 4, 0, 21,…
#> $ indexed_at    <dttm> 2024-01-02 13:17:27, 2024-01-02 10:32:49, 2024-01-02 09…
#> $ in_reply_to   <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ in_reply_root <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ quotes        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
```

## Learn More?

Start with the [Basic
Usage](https://jbgruber.github.io/atr/articles/Basic_Usage.html)
vignette to learn more.

# Want to help?

You can help by creating an
[issue](https://github.com/JBGruber/atr/issues/new/choose) requesting
new features or reporting bugs.

If you are a developer, we are happy to accept pull requests. It should
be fairly straightforward, as all endpoints are already covered by
automatically generated function. For example, the endpoint
[app.bsky.actor.getProfiles](https://atproto.com/lexicons/app-bsky) is
accessible via `atr:::app_bsky_actor_get_profiles()`. The function
`get_user_info()` is just a thin wrapper around that and calls an
optional parsing function:

    get_user_info <- function(actor,
                              parse = TRUE,
                              .token = NULL) {

      # we need to use do.call so objects are passed to the right environment
      res <- do.call( 
        what = app_bsky_actor_get_profiles,
        args = list(
          actor,
          .token = .token,
          .return = "json"
        )) |>
        purrr::pluck("profiles")

      if (parse) {
        res <- parse_actors(res)
      }
      return(res)
    }

If you find an endpoint at <https://atproto.com/lexicons/com-atproto> or
<https://atproto.com/lexicons/app-bsky> that interests you, you can
write a similar wrapper and contribute it to the package (or build
something new on top of it). But please open an
[issue](https://github.com/JBGruber/atr/issues) first, so we don’t do
duplicated work.
